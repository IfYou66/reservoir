{"remainingRequest":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\src\\permission.js","dependencies":[{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\src\\permission.js","mtime":1640096689568},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711181250741},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1711181252330},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\eslint-loader\\index.js","mtime":1711181251177}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJEOi9HcmFkdWF0aW9uUHJvamVjdC9maW5hbC9yZXNlcnZpb2lyL3Jlc2VydmlvaXItdWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0IikuZGVmYXVsdDsKCnZhciBfb2JqZWN0U3ByZWFkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiRDovR3JhZHVhdGlvblByb2plY3QvZmluYWwvcmVzZXJ2aW9pci9yZXNlcnZpb2lyLXVpL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIiKSk7Cgp2YXIgX3JvdXRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi9yb3V0ZXIiKSk7Cgp2YXIgX3N0b3JlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCIuL3N0b3JlIikpOwoKdmFyIF9lbGVtZW50VWkgPSByZXF1aXJlKCJlbGVtZW50LXVpIik7Cgp2YXIgX25wcm9ncmVzcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibnByb2dyZXNzIikpOwoKcmVxdWlyZSgibnByb2dyZXNzL25wcm9ncmVzcy5jc3MiKTsKCnZhciBfYXV0aCA9IHJlcXVpcmUoIkAvdXRpbHMvYXV0aCIpOwoKX25wcm9ncmVzcy5kZWZhdWx0LmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOwoKdmFyIHdoaXRlTGlzdCA9IFsnL2xvZ2luJywgJy9hdXRoLXJlZGlyZWN0JywgJy9iaW5kJywgJy9yZWdpc3RlcicsICcvZmxhc2gnLCAnL3N1YnN5c3RlbScsICcvcmVzZXJ2b2lyJ107Cgpfcm91dGVyLmRlZmF1bHQuYmVmb3JlRWFjaChmdW5jdGlvbiAodG8sIGZyb20sIG5leHQpIHsKICBfbnByb2dyZXNzLmRlZmF1bHQuc3RhcnQoKTsKCiAgaWYgKCgwLCBfYXV0aC5nZXRUb2tlbikoKSkgewogICAgLyogaGFzIHRva2VuKi8KICAgIGlmICh0by5wYXRoID09PSAnL2xvZ2luJykgewogICAgICBuZXh0KHsKICAgICAgICBwYXRoOiAnLycKICAgICAgfSk7CgogICAgICBfbnByb2dyZXNzLmRlZmF1bHQuZG9uZSgpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKF9zdG9yZS5kZWZhdWx0LmdldHRlcnMucm9sZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgLy8g5Yik5pat5b2T5YmN55So5oi35piv5ZCm5bey5ouJ5Y+W5a6MdXNlcl9pbmZv5L+h5oGvCiAgICAgICAgX3N0b3JlLmRlZmF1bHQuZGlzcGF0Y2goJ0dldEluZm8nKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF9zdG9yZS5kZWZhdWx0LmRpc3BhdGNoKCdHZW5lcmF0ZVJvdXRlcycpLnRoZW4oZnVuY3Rpb24gKGFjY2Vzc1JvdXRlcykgewogICAgICAgICAgICAvLyDmoLnmja5yb2xlc+adg+mZkOeUn+aIkOWPr+iuv+mXrueahOi3r+eUseihqAogICAgICAgICAgICBfcm91dGVyLmRlZmF1bHQuYWRkUm91dGVzKGFjY2Vzc1JvdXRlcyk7IC8vIOWKqOaAgea3u+WKoOWPr+iuv+mXrui3r+eUseihqAoKCiAgICAgICAgICAgIG5leHQoKDAsIF9vYmplY3RTcHJlYWQyLmRlZmF1bHQpKCgwLCBfb2JqZWN0U3ByZWFkMi5kZWZhdWx0KSh7fSwgdG8pLCB7fSwgewogICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUKICAgICAgICAgICAgfSkpOyAvLyBoYWNr5pa55rOVIOehruS/nWFkZFJvdXRlc+W3suWujOaIkAogICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgX3N0b3JlLmRlZmF1bHQuZGlzcGF0Y2goJ0xvZ091dCcpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfZWxlbWVudFVpLk1lc3NhZ2UuZXJyb3IoZXJyKTsKCiAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgIHBhdGg6ICcvJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG5leHQoKTsKICAgICAgfQogICAgfQogIH0gZWxzZSB7CiAgICAvLyDmsqHmnIl0b2tlbgogICAgaWYgKHdoaXRlTGlzdC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSkgewogICAgICAvLyDlnKjlhY3nmbvlvZXnmb3lkI3ljZXvvIznm7TmjqXov5vlhaUKICAgICAgbmV4dCgpOwogICAgfSBlbHNlIHsKICAgICAgLy9uZXh0KGAvbG9naW4/cmVkaXJlY3Q9JHt0by5mdWxsUGF0aH1gKSAvLyDlkKbliJnlhajpg6jph43lrprlkJHliLDnmbvlvZXpobUKICAgICAgaWYgKHRvLnBhdGggPT09ICcvaW5kZXgnKSB7CiAgICAgICAgbmV4dCgnL2ZsYXNoJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV4dCh0by5wYXRoKTsgLy8g5ZCm5YiZ5YWo6YOo6YeN5a6a5ZCR5Yiw55m75b2V6aG1CiAgICAgIH0KCiAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7CiAgICB9CiAgfQp9KTsKCl9yb3V0ZXIuZGVmYXVsdC5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7Cn0pOw=="},{"version":3,"sources":["D:/GraduationProject/final/reservioir/reservioir-ui/src/permission.js"],"names":["NProgress","configure","showSpinner","whiteList","router","beforeEach","to","from","next","start","path","done","store","getters","roles","length","dispatch","then","accessRoutes","addRoutes","replace","catch","err","Message","error","indexOf","afterEach"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEAA,mBAAUC,SAAV,CAAoB;AAACC,EAAAA,WAAW,EAAE;AAAd,CAApB;;AAEA,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,gBAAX,EAA6B,OAA7B,EAAsC,WAAtC,EAAmD,QAAnD,EAA6D,YAA7D,EAA0E,YAA1E,CAAlB;;AAEAC,gBAAOC,UAAP,CAAkB,UAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACpCR,qBAAUS,KAAV;;AACA,MAAI,qBAAJ,EAAgB;AACd;AACA,QAAIH,EAAE,CAACI,IAAH,KAAY,QAAhB,EAA0B;AACxBF,MAAAA,IAAI,CAAC;AAACE,QAAAA,IAAI,EAAE;AAAP,OAAD,CAAJ;;AACAV,yBAAUW,IAAV;AACD,KAHD,MAGO;AACL,UAAIC,eAAMC,OAAN,CAAcC,KAAd,CAAoBC,MAApB,KAA+B,CAAnC,EAAsC;AACpC;AACAH,uBAAMI,QAAN,CAAe,SAAf,EAA0BC,IAA1B,CAA+B,YAAM;AACnCL,yBAAMI,QAAN,CAAe,gBAAf,EAAiCC,IAAjC,CAAsC,UAAAC,YAAY,EAAI;AACpD;AACAd,4BAAOe,SAAP,CAAiBD,YAAjB,EAFoD,CAErB;;;AAC/BV,YAAAA,IAAI,6DAAKF,EAAL;AAASc,cAAAA,OAAO,EAAE;AAAlB,eAAJ,CAHoD,CAGvB;AAC9B,WAJD;AAKD,SAND,EAMGC,KANH,CAMS,UAAAC,GAAG,EAAI;AACdV,yBAAMI,QAAN,CAAe,QAAf,EAAyBC,IAAzB,CAA8B,YAAM;AAClCM,+BAAQC,KAAR,CAAcF,GAAd;;AACAd,YAAAA,IAAI,CAAC;AAACE,cAAAA,IAAI,EAAE;AAAP,aAAD,CAAJ;AACD,WAHD;AAID,SAXD;AAYD,OAdD,MAcO;AACLF,QAAAA,IAAI;AACL;AACF;AACF,GAxBD,MAwBO;AACL;AACA,QAAIL,SAAS,CAACsB,OAAV,CAAkBnB,EAAE,CAACI,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrC;AACAF,MAAAA,IAAI;AACL,KAHD,MAGO;AACL;AACA,UAAIF,EAAE,CAACI,IAAH,KAAY,QAAhB,EAAyB;AACvBF,QAAAA,IAAI,CAAC,QAAD,CAAJ;AACD,OAFD,MAEK;AACHA,QAAAA,IAAI,CAACF,EAAE,CAACI,IAAJ,CAAJ,CADG,CACW;AACf;;AACDV,yBAAUW,IAAV;AACD;AACF;AACF,CAzCD;;AA2CAP,gBAAOsB,SAAP,CAAiB,YAAM;AACrB1B,qBAAUW,IAAV;AACD,CAFD","sourcesContent":["import router from './router'\nimport store from './store'\nimport {Message} from 'element-ui'\nimport NProgress from 'nprogress'\nimport 'nprogress/nprogress.css'\nimport {getToken} from '@/utils/auth'\n\nNProgress.configure({showSpinner: false})\n\nconst whiteList = ['/login', '/auth-redirect', '/bind', '/register', '/flash', '/subsystem','/reservoir'];\n\nrouter.beforeEach((to, from, next) => {\n  NProgress.start();\n  if (getToken()) {\n    /* has token*/\n    if (to.path === '/login') {\n      next({path: '/'});\n      NProgress.done()\n    } else {\n      if (store.getters.roles.length === 0) {\n        // 判断当前用户是否已拉取完user_info信息\n        store.dispatch('GetInfo').then(() => {\n          store.dispatch('GenerateRoutes').then(accessRoutes => {\n            // 根据roles权限生成可访问的路由表\n            router.addRoutes(accessRoutes) // 动态添加可访问路由表\n            next({...to, replace: true}) // hack方法 确保addRoutes已完成\n          })\n        }).catch(err => {\n          store.dispatch('LogOut').then(() => {\n            Message.error(err)\n            next({path: '/'})\n          })\n        })\n      } else {\n        next()\n      }\n    }\n  } else {\n    // 没有token\n    if (whiteList.indexOf(to.path) !== -1) {\n      // 在免登录白名单，直接进入\n      next()\n    } else {\n      //next(`/login?redirect=${to.fullPath}`) // 否则全部重定向到登录页\n      if (to.path === '/index'){\n        next('/flash')\n      }else{\n        next(to.path) // 否则全部重定向到登录页\n      }\n      NProgress.done()\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done()\n})\n"]}]}