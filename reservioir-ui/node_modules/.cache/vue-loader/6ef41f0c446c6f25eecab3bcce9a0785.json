{"remainingRequest":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\src\\App.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\src\\App.vue","mtime":1701786842453},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711181250741},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1711181252330},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1711181250741},{"path":"D:\\GraduationProject\\final\\reservioir\\reservioir-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1711181252689}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQXBwJywKICBkYXRhKCkgewogICAgLyoqCiAgICAgKiDmiJDlip/ojrflj5bmlbDmja7lkI7nmoTlpITnkIblh73mlbAKICAgICAqIEBwYXJhbSByZXN1bHQg5LuO5pyN5Yqh5Zmo6I635Y+W55qE5pWw5o2uCiAgICAgKi8KICAgIGNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdAL2FwaS9jb2xsZWN0aW9uL3JlcXVlc3QnKTsKICAgIGNvbnN0IGNvbW1vbiA9IHJlcXVpcmUoJ0AvYXBpL2NvbGxlY3Rpb24vY29tbW9uJyk7CiAgICBjb25zdCByZXNlcnZvaXIgPSByZXF1aXJlKCdAL2FwaS9jb2xsZWN0aW9uLycgKyBjb21tb24uQ1VSUkVOVF9SRVNFUlZPSVIgKyAnL3Jlc2Vydm9pcicpOwogICAgY29uc3Qgc2Vuc29yTGlzdCA9IHJlcXVpcmUoJ0AvYXBpL2NvbGxlY3Rpb24vJyArIGNvbW1vbi5DVVJSRU5UX1JFU0VSVk9JUiArICcvc2Vuc29yTGlzdCcpOwogICAgY29uc3Qgb3BlcmF0b3IgPSByZXF1aXJlKCdAL2FwaS9jb2xsZWN0aW9uL29wZXJhdG9yJyk7CgoKICAgIGxldCBzZW5kUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHsgICAgICAgICAgICAgICAgICAgICAvL+WRqOacn+WPkemAgeaVsOaNruivt+axggogICAgICByZXNlcnZvaXIuc2VuZEluZm8oKTsKICAgICAgc2V0SW50ZXJ2YWwocmVzZXJ2b2lyLnNlbmRJbmZvLCBjb21tb24uVElNRV9TUEFOKTsKICAgIH0oKTsKCiAgICB3aW5kb3cuZG9TdWNjZXNzID0gZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICBpZiAoIXJlc3VsdCkgcmV0dXJuOwogICAgICBsZXQgc2Vuc29ycyA9IGNvbW1vbi5sb2FkU2Vuc29ycygpOwogICAgICBpZiAoIXNlbnNvcnMpIHsKICAgICAgICBzZW5zb3JzID0gc2Vuc29yTGlzdC5jcmVhdGVTZW5zb3JzKCk7CiAgICAgIH0KICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAyICYmIHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMV0uU2Vuc29ySUQgPT09IHJlc3VsdFswXS5TZW5zb3JJRCkgeyAgIC8v6ZW/5pWI5oOF5Ya15aSE55CG77yM5q2k5pe26I635Y+W55qE5piv5LiA5Liq5bCP5pe255qE5Y6G5Y+y5pWw5o2uCiAgICAgICAgbGV0IHNlbnNvciA9IG9wZXJhdG9yLmdldFNlbnNvcihzZW5zb3JzLCAnaWQnLCByZXN1bHRbMF0uU2Vuc29ySUQpOwogICAgICAgIGxldCBuZXdBcnIgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgbGV0IHZhbHVlID0gcGFyc2VGbG9hdChyZXN1bHRbaV0uRGF0YVZhbHVlKTsKICAgICAgICAgIGlmICh2YWx1ZSA+IHNlbnNvci5sb3cgJiYgdmFsdWUgPCBzZW5zb3IuaGlnaCAmJiAoaSA+IDAgJiYgcmVzdWx0W2ldLlJldlRpbWUgIT09IHJlc3VsdFtpIC0gMV0uUmV2VGltZSkpIHsKICAgICAgICAgICAgbmV3QXJyLnB1c2gocmVzdWx0W2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGV0IGlzRGFtID0gc2Vuc29yICYmIHNlbnNvci5wYXJ0LmluZGV4T2YoJ2RhbScpID49IDA7CiAgICAgICAgbGV0IGlzR2F0ZSA9IHNlbnNvciAmJiBzZW5zb3IucGFydC5pbmRleE9mKCdnYXRlJykgPj0gMDsKICAgICAgICBsZXQgaXNMZXZlbCA9IHNlbnNvci5uYW1lID09PSAn5rC05L2NJzsKICAgICAgICBpZiAoaXNEYW0gfHwgaXNHYXRlKSB7CiAgICAgICAgICBsZXQgZmlyc3QsIGxhc3Q7CgogICAgICAgICAgaWYgKG5ld0Fyci5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIGZpcnN0ID0gMDsKICAgICAgICAgICAgbGFzdCA9IDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaXJzdCA9IG5ld0FycltuZXdBcnIubGVuZ3RoIC0gMV0uRGF0YVZhbHVlOwogICAgICAgICAgICBsYXN0ID0gbmV3QXJyWzBdLkRhdGFWYWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IE1hdGguYWJzKGZpcnN0IC0gbGFzdCk7CgogICAgICAgICAgbGV0IHNlbiA9IG9wZXJhdG9yLmdldFNlbnNvcihzZW5zb3JzLCAndGFnJywgaXNEYW0gPyAnZGFtLWFjY3VtdWxhdGUtZG93bi1zcGVlZCcgOiAnZ2F0ZS1hY2N1bXVsYXRlLWRvd24tc3BlZWQnKTsKICAgICAgICAgIGlmIChzZW4gJiYgbmV3VmFsdWUgPiBzZW4udmFsdWUpIHsKICAgICAgICAgICAgb3BlcmF0b3IuZ2V0U2Vuc29yKHNlbnNvcnMsICd0YWcnLCBpc0RhbSA/ICdkYW0tYWNjdW11bGF0ZS1kb3duLXNwZWVkJyA6CiAgICAgICAgICAgICAgJ2dhdGUtYWNjdW11bGF0ZS1kb3duLXNwZWVkJykudmFsdWUgPSBvcGVyYXRvci5maXgobmV3VmFsdWUsIHNlbi5wcmVjaXNpb24pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNMZXZlbCkgewogICAgICAgICAgbGV0IHN1bSA9IDA7CiAgICAgICAgICBsZXQgdGltZSA9IDA7CiAgICAgICAgICBuZXdBcnIgPSBuZXdBcnIuc2xpY2UobmV3QXJyLmxlbmd0aCAtIDIxIDwgMCA/IDAgOiBuZXdBcnIubGVuZ3RoIC0gMjEsIG5ld0Fyci5sZW5ndGgpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdBcnIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKChuZXcgRGF0ZShuZXdBcnJbbmV3QXJyLmxlbmd0aCAtIDFdLlJldlRpbWUpIC0KICAgICAgICAgICAgICBuZXcgRGF0ZShuZXdBcnJbaV0uUmV2VGltZSkpIC8gNjAgLyA2MCAvIDEwMDAgPD0gMikgewogICAgICAgICAgICAgIHN1bSArPSBuZXdBcnJbaV0uRGF0YVZhbHVlOwogICAgICAgICAgICAgIHRpbWUrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc2Vuc29yLnNldFZhbHVlKHN1bSAvIHRpbWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsgICAvL+ato+W4uOaDheWGtQogICAgICAgIGxldCBicm9rZW4gPSBmYWxzZTsKICAgICAgICBmb3IgKGxldCBpIGluIHNlbnNvcnMpIHsKICAgICAgICAgIGZvciAobGV0IGogaW4gcmVzdWx0KSB7CiAgICAgICAgICAgIGlmIChzZW5zb3JzW2ldLm5hbWUgPT09ICfmsLTkvY0nICYmIHNlbnNvcnNbaV0uc21vb3RoKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKHNlbnNvcnNbaV0uaWQgPT09IHJlc3VsdFtqXS5TZW5zb3JJRCAmJiByZXN1bHRbal0uRGF0YVZhbHVlIDwgY29tbW9uLkJPVU5EQVJZLzIgJiYgcmVzdWx0W2pdLkRhdGFWYWx1ZSAhPT0gY29tbW9uLklOVkFMSUQpIHsKICAgICAgICAgICAgICBpZiAoc2Vuc29yc1tpXS5pZCA9PT0gJ01IU0tTWVAxMTAwMScpewogICAgICAgICAgICAgICAgc2Vuc29yc1tpXS5zZXRWYWx1ZShyZXN1bHRbal0uRGF0YVZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2Vuc29yc1tpXS5zZXRWYWx1ZShyZXN1bHRbal0uRGF0YVZhbHVlKTsKICAgICAgICAgICAgICBzZW5zb3JzW2ldLnNldFRpbWUocmVzdWx0W2pdLlJldlRpbWUpOwoKICAgICAgICAgICAgICAvL+WIpOaWremYsua4l+mAj+iGnOaYr+WQpuaNn+WdjwogICAgICAgICAgICAgIGlmIChzZW5zb3JzW2ldLmludmFsaWQpIHsKICAgICAgICAgICAgICAgIGlmIChzZW5zb3JzW2ldLnZhbHVlID4gc2Vuc29yc1tpXS5taW4pIHsKICAgICAgICAgICAgICAgICAgYnJva2VuID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2Jyb2tlbicsIGJyb2tlbik7CiAgICAgIH0KICAgICAgY29tbW9uLnJlZnJlc2hTZW5zb3JzKHNlbnNvcnMpOwoKICAgIH07CgogICAgcmV0dXJuIHt9OwogIH0KfQo="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <div id=\"app\">\n    <router-view/>\n  </div>\n</template>\n\n<script>\n  export default {\n    name: 'App',\n    data() {\n      /**\n       * 成功获取数据后的处理函数\n       * @param result 从服务器获取的数据\n       */\n      const request = require('@/api/collection/request');\n      const common = require('@/api/collection/common');\n      const reservoir = require('@/api/collection/' + common.CURRENT_RESERVOIR + '/reservoir');\n      const sensorList = require('@/api/collection/' + common.CURRENT_RESERVOIR + '/sensorList');\n      const operator = require('@/api/collection/operator');\n\n\n      let sendRequest = function () {                     //周期发送数据请求\n        reservoir.sendInfo();\n        setInterval(reservoir.sendInfo, common.TIME_SPAN);\n      }();\n\n      window.doSuccess = function (result) {\n        if (!result) return;\n        let sensors = common.loadSensors();\n        if (!sensors) {\n          sensors = sensorList.createSensors();\n        }\n        if (result.length > 2 && result[result.length - 1].SensorID === result[0].SensorID) {   //长效情况处理，此时获取的是一个小时的历史数据\n          let sensor = operator.getSensor(sensors, 'id', result[0].SensorID);\n          let newArr = [];\n          for (let i = 0; i < result.length; i++) {\n            let value = parseFloat(result[i].DataValue);\n            if (value > sensor.low && value < sensor.high && (i > 0 && result[i].RevTime !== result[i - 1].RevTime)) {\n              newArr.push(result[i]);\n            }\n          }\n          let isDam = sensor && sensor.part.indexOf('dam') >= 0;\n          let isGate = sensor && sensor.part.indexOf('gate') >= 0;\n          let isLevel = sensor.name === '水位';\n          if (isDam || isGate) {\n            let first, last;\n\n            if (newArr.length < 2) {\n              first = 0;\n              last = 0;\n            } else {\n              first = newArr[newArr.length - 1].DataValue;\n              last = newArr[0].DataValue;\n            }\n            let newValue = Math.abs(first - last);\n\n            let sen = operator.getSensor(sensors, 'tag', isDam ? 'dam-accumulate-down-speed' : 'gate-accumulate-down-speed');\n            if (sen && newValue > sen.value) {\n              operator.getSensor(sensors, 'tag', isDam ? 'dam-accumulate-down-speed' :\n                'gate-accumulate-down-speed').value = operator.fix(newValue, sen.precision);\n            }\n          } else if (isLevel) {\n            let sum = 0;\n            let time = 0;\n            newArr = newArr.slice(newArr.length - 21 < 0 ? 0 : newArr.length - 21, newArr.length);\n            for (let i = 0; i < newArr.length; i++) {\n              if ((new Date(newArr[newArr.length - 1].RevTime) -\n                new Date(newArr[i].RevTime)) / 60 / 60 / 1000 <= 2) {\n                sum += newArr[i].DataValue;\n                time++;\n              }\n            }\n            sensor.setValue(sum / time);\n          }\n        } else {   //正常情况\n          let broken = false;\n          for (let i in sensors) {\n            for (let j in result) {\n              if (sensors[i].name === '水位' && sensors[i].smooth) continue;\n              if (sensors[i].id === result[j].SensorID && result[j].DataValue < common.BOUNDARY/2 && result[j].DataValue !== common.INVALID) {\n                if (sensors[i].id === 'MHSKSYP11001'){\n                  sensors[i].setValue(result[j].DataValue);\n                }\n                sensors[i].setValue(result[j].DataValue);\n                sensors[i].setTime(result[j].RevTime);\n\n                //判断防渗透膜是否损坏\n                if (sensors[i].invalid) {\n                  if (sensors[i].value > sensors[i].min) {\n                    broken = true;\n                  }\n                }\n              }\n            }\n          }\n          localStorage.setItem('broken', broken);\n        }\n        common.refreshSensors(sensors);\n\n      };\n\n      return {};\n    }\n  }\n</script>\n"]}]}